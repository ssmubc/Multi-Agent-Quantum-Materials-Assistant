option_settings:
  aws:elasticbeanstalk:application:environment:
    # CloudFront integration settings
    CLOUDFRONT_ENABLED: "true"
    
files:
  "/opt/elasticbeanstalk/tasks/taillogs.d/streamlit.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      /var/log/eb-docker/containers/eb-current-app/stdouterr.log

container_commands:
  01_cloudfront_headers:
    command: |
      cat > /tmp/cloudfront_headers.py << 'EOF'
      # CloudFront header configuration for Streamlit
      import streamlit as st
      
      # Configure Streamlit for CloudFront
      st.set_page_config(
          page_title="Quantum Matter Platform",
          page_icon="⚛️",
          layout="wide",
          initial_sidebar_state="expanded"
      )
      
      # Handle CloudFront forwarded headers
      def configure_cloudfront():
          import os
          if os.getenv('CLOUDFRONT_ENABLED') == 'true':
              # Trust CloudFront headers
              os.environ['STREAMLIT_SERVER_ENABLE_CORS'] = 'false'
              os.environ['STREAMLIT_SERVER_ENABLE_XSRF_PROTECTION'] = 'false'
      
      configure_cloudfront()
      EOF
    leader_only: true